(self.webpackChunk_central_factory_portal=self.webpackChunk_central_factory_portal||[]).push([[700],{8700:(L,m,r)=>{r.r(m),r.d(m,{SelectAvatarModule:()=>D});var s=r(1457),p=r(4438),M=r(943),t=r(7777);let x=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[s.CommonModule,p.O,M.y]]}),e})();var v=r(428),E=r(6435),I=r(1135),f=r(3900),A=r(4128),d=r(8505),C=r(9646),j=r(4004);let R=(()=>{class e{constructor(a){this.entityManager=a,this.avatars$=new I.X([]),this.entityManager.initialize$.pipe((0,f.w)(()=>(0,A.D)([this.entityManager.getRepository("useravatars","com.central-factory.avatars")])),(0,d.b)(([n])=>{this.userAvatarsRepository=n,this.subscribeToDataChanges()})).subscribe()}subscribeToDataChanges(){if(!this.userAvatarsRepository)throw new Error("Repositories not initialized");this.userAvatarsRepository.observe().pipe((0,f.w)(a=>a.length>0?(0,A.D)(a.map(n=>n._attachments&&Object.keys(n._attachments).length>0?this.userAvatarsRepository.getAllAttachments(n.id).pipe((0,j.U)(l=>(n.appearances.forEach(o=>{const g=l.find(u=>u.id===o.portrait.id);g&&(o.portrait.src=URL.createObjectURL(g.data));const y=l.find(u=>u.id===o.id);y&&(o.src=URL.createObjectURL(y.data))}),n.selectedAppearance=n.appearances.find(o=>o.id===n.selectedAppearance.id),n))):(0,C.of)(n))):(0,C.of)(a)),(0,d.b)(a=>this.avatars$.next(a))).subscribe()}}return e.\u0275fac=function(a){return new(a||e)(t.\u0275\u0275inject(E.v2))},e.\u0275prov=t.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=r(7165),S=r(1623),h=r(3454),k=r(7967),F=r(6315);function T(e,c){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"div",2),t.\u0275\u0275listener("click",function(){const l=t.\u0275\u0275restoreView(a).$implicit;return t.\u0275\u0275nextContext().avatarClick.emit(l)}),t.\u0275\u0275element(2,"cf-avatar-appearance-portrait",3),t.\u0275\u0275element(3,"br"),t.\u0275\u0275elementStart(4,"h4",4),t.\u0275\u0275text(5),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()}if(2&e){const a=c.$implicit;t.\u0275\u0275advance(2),t.\u0275\u0275property("appearancePortrait",null==a.selectedAppearance?null:a.selectedAppearance.portrait),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(a.name)}}let O=(()=>{class e{constructor(){this.avatars=[],this.avatarClick=new t.EventEmitter}}return e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=t.\u0275\u0275defineComponent({type:e,selectors:[["cf-avatars-carousel"]],inputs:{avatars:"avatars"},outputs:{avatarClick:"avatarClick"},decls:2,vars:1,consts:[["cfBlock","avatars-carousel"],[4,"ngFor","ngForOf"],["cfBlock","avatars-carousel-item",3,"click"],[3,"appearancePortrait"],["cfElem","name"]],template:function(a,n){1&a&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275template(1,T,6,2,"ng-container",1),t.\u0275\u0275elementEnd()),2&a&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",n.avatars))},directives:[S.G,s.NgForOf,F.P,h.e],encapsulation:2}),e})();function $(e,c){1&e&&(t.\u0275\u0275elementStart(0,"h2",7),t.\u0275\u0275text(1," Select an Avatar "),t.\u0275\u0275elementEnd())}function B(e,c){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",8),t.\u0275\u0275elementStart(1,"cf-avatars-carousel",9),t.\u0275\u0275listener("avatarClick",function(i){return t.\u0275\u0275restoreView(a),t.\u0275\u0275nextContext(2).onAvatarClick(i)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()}if(2&e){const a=t.\u0275\u0275nextContext().ngIf;t.\u0275\u0275advance(1),t.\u0275\u0275property("avatars",a.avatars)}}const _=function(){return["primary"]};function V(e,c){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"div",1),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275template(3,$,2,0,"h2",3),t.\u0275\u0275template(4,B,2,1,"div",4),t.\u0275\u0275elementStart(5,"div",5),t.\u0275\u0275elementStart(6,"button",6),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(a),t.\u0275\u0275nextContext().onCreateAvatarClick()}),t.\u0275\u0275text(7," Create a new Avatar "),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()}if(2&e){const a=c.ngIf;t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",a.avatars&&a.avatars.length>0),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.avatars&&a.avatars.length>0),t.\u0275\u0275advance(2),t.\u0275\u0275property("cfMod",t.\u0275\u0275pureFunction0(3,_))}}const N=function(e){return{avatars:e}},U=[{path:"",component:(()=>{class e{constructor(a,n,i){this.router=a,this.selectedAvatarState=n,this.availableAvatarsState=i,this.avatars$=this.availableAvatarsState.avatars$}onAvatarClick(a){this.selectedAvatarState.selectAvatar(a).pipe((0,d.b)(()=>this.router.navigate(["/start"]))).subscribe()}onCreateAvatarClick(){this.router.navigate(["/create-avatar"])}}return e.\u0275fac=function(a){return new(a||e)(t.\u0275\u0275directiveInject(v.Router),t.\u0275\u0275directiveInject(b.Y),t.\u0275\u0275directiveInject(R))},e.\u0275cmp=t.\u0275\u0275defineComponent({type:e,selectors:[["cf-select-avatar"]],decls:2,vars:5,consts:[[4,"ngIf"],["cfBlock","scene-content"],["cfBlock","select-avatar"],["cfElem","title",4,"ngIf"],["cfElem","avatars-carousel",4,"ngIf"],["cfElem","create-avatar"],["cfBlock","button",3,"cfMod","click"],["cfElem","title"],["cfElem","avatars-carousel"],[3,"avatars","avatarClick"]],template:function(a,n){1&a&&(t.\u0275\u0275template(0,V,8,4,"ng-container",0),t.\u0275\u0275pipe(1,"async")),2&a&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pureFunction1(3,N,t.\u0275\u0275pipeBind1(1,1,n.avatars$)))},directives:[s.NgIf,S.G,h.e,k.I,O],pipes:[s.AsyncPipe],encapsulation:2}),e})()}];let w=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[v.RouterModule.forChild(U)],v.RouterModule]}),e})(),D=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[s.CommonModule,p.O,x,w]]}),e})()}}]);