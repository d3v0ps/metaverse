(self.webpackChunk_central_factory_portal=self.webpackChunk_central_factory_portal||[]).push([[700],{8700:(L,d,o)=>{o.r(d),o.d(d,{SelectAvatarModule:()=>D});var i=o(1457),m=o(4438),x=o(9301),t=o(7777);let M=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[i.CommonModule,m.O,x.y]]}),e})();var v=o(428),E=o(6435),I=o(1135),f=o(3900),A=o(4128),p=o(8505),C=o(9646),j=o(4004);let _=(()=>{class e{constructor(a){this.entityManager=a,this.avatars$=new I.X([]),this.entityManager.initialize$.pipe((0,f.w)(()=>(0,A.D)([this.entityManager.getRepository("useravatars","com.central-factory.avatars")])),(0,p.b)(([r])=>{this.userAvatarsRepository=r,this.subscribeToDataChanges()})).subscribe()}subscribeToDataChanges(){if(!this.userAvatarsRepository)throw new Error("Repositories not initialized");this.userAvatarsRepository.observe().pipe((0,f.w)(a=>a.length>0?(0,A.D)(a.map(r=>r._attachments&&Object.keys(r._attachments).length>0?this.userAvatarsRepository.getAllAttachments(r.id).pipe((0,j.U)(l=>(r.appearances.forEach(c=>{const S=l.find(u=>u.id===c.variations?.portrait.id);S&&c.variations?.portrait&&(c.variations.portrait.src=URL.createObjectURL(S.data));const y=l.find(u=>u.id===c.id);y&&(c.src=URL.createObjectURL(y.data))}),r.selectedAppearance=r.appearances.find(c=>c.id===r.selectedAppearance.id),r))):(0,C.of)(r))):(0,C.of)(a)),(0,p.b)(a=>this.avatars$.next(a))).subscribe()}}return e.\u0275fac=function(a){return new(a||e)(t.\u0275\u0275inject(E.v2))},e.\u0275prov=t.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var R=o(7165),g=o(1623),h=o(3454),b=o(7967),k=o(2839);function F(e,n){if(1&e&&t.\u0275\u0275element(0,"cf-avatar-appearance-portrait",5),2&e){const a=t.\u0275\u0275nextContext().$implicit;t.\u0275\u0275property("appearancePortrait",null==a.selectedAppearance||null==a.selectedAppearance.variations?null:a.selectedAppearance.variations.portrait)}}function T(e,n){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"div",2),t.\u0275\u0275listener("click",function(){const l=t.\u0275\u0275restoreView(a).$implicit;return t.\u0275\u0275nextContext().avatarClick.emit(l)}),t.\u0275\u0275template(2,F,1,1,"cf-avatar-appearance-portrait",3),t.\u0275\u0275element(3,"br"),t.\u0275\u0275elementStart(4,"h4",4),t.\u0275\u0275text(5),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()}if(2&e){const a=n.$implicit;t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",null==a.selectedAppearance?null:a.selectedAppearance.variations),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(a.name)}}let $=(()=>{class e{constructor(){this.avatars=[],this.variation="portrait",this.avatarClick=new t.EventEmitter}}return e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=t.\u0275\u0275defineComponent({type:e,selectors:[["cf-avatars-carousel"]],inputs:{avatars:"avatars",variation:"variation"},outputs:{avatarClick:"avatarClick"},decls:2,vars:1,consts:[["cfBlock","avatars-carousel"],[4,"ngFor","ngForOf"],["cfBlock","avatars-carousel-item",3,"click"],[3,"appearancePortrait",4,"ngIf"],["cfElem","name"],[3,"appearancePortrait"]],template:function(a,r){1&a&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275template(1,T,6,2,"ng-container",1),t.\u0275\u0275elementEnd()),2&a&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",r.avatars))},directives:[g.G,i.NgForOf,i.NgIf,h.e,k.P],encapsulation:2}),e})();function O(e,n){1&e&&(t.\u0275\u0275elementStart(0,"h2",7),t.\u0275\u0275text(1," Select an Avatar "),t.\u0275\u0275elementEnd())}function B(e,n){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",8),t.\u0275\u0275elementStart(1,"cf-avatars-carousel",9),t.\u0275\u0275listener("avatarClick",function(s){return t.\u0275\u0275restoreView(a),t.\u0275\u0275nextContext(2).onAvatarClick(s)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()}if(2&e){const a=t.\u0275\u0275nextContext().ngIf;t.\u0275\u0275advance(1),t.\u0275\u0275property("avatars",a.avatars)}}const N=function(){return["primary"]};function V(e,n){if(1&e){const a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"div",1),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275template(3,O,2,0,"h2",3),t.\u0275\u0275template(4,B,2,1,"div",4),t.\u0275\u0275elementStart(5,"div",5),t.\u0275\u0275elementStart(6,"button",6),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(a),t.\u0275\u0275nextContext().onCreateAvatarClick()}),t.\u0275\u0275text(7," Create a new Avatar "),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()}if(2&e){const a=n.ngIf;t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",a.avatars&&a.avatars.length>0),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.avatars&&a.avatars.length>0),t.\u0275\u0275advance(2),t.\u0275\u0275property("cfMod",t.\u0275\u0275pureFunction0(3,N))}}const P=function(e){return{avatars:e}},U=[{path:"",component:(()=>{class e{constructor(a,r,s){this.router=a,this.selectedAvatarState=r,this.availableAvatarsState=s,this.avatars$=this.availableAvatarsState.avatars$}onAvatarClick(a){this.selectedAvatarState.selectAvatar(a).pipe((0,p.b)(()=>this.router.navigate(["/start"]))).subscribe()}onCreateAvatarClick(){this.router.navigate(["/create-avatar"])}}return e.\u0275fac=function(a){return new(a||e)(t.\u0275\u0275directiveInject(v.Router),t.\u0275\u0275directiveInject(R.Y),t.\u0275\u0275directiveInject(_))},e.\u0275cmp=t.\u0275\u0275defineComponent({type:e,selectors:[["cf-select-avatar"]],decls:2,vars:5,consts:[[4,"ngIf"],["cfBlock","scene-content"],["cfBlock","select-avatar"],["cfElem","title",4,"ngIf"],["cfElem","avatars-carousel",4,"ngIf"],["cfElem","create-avatar"],["cfBlock","button",3,"cfMod","click"],["cfElem","title"],["cfElem","avatars-carousel"],[3,"avatars","avatarClick"]],template:function(a,r){1&a&&(t.\u0275\u0275template(0,V,8,4,"ng-container",0),t.\u0275\u0275pipe(1,"async")),2&a&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pureFunction1(3,P,t.\u0275\u0275pipeBind1(1,1,r.avatars$)))},directives:[i.NgIf,g.G,h.e,b.I,$],pipes:[i.AsyncPipe],encapsulation:2}),e})()}];let w=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[v.RouterModule.forChild(U)],v.RouterModule]}),e})(),D=(()=>{class e{}return e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=t.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=t.\u0275\u0275defineInjector({imports:[[i.CommonModule,m.O,M,w]]}),e})()}}]);